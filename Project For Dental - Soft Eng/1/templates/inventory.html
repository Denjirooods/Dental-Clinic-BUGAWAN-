<!DOCTYPE html>
<html>
<head>
    <title>Inventory Items - MCVIL DENTAL CLINIC Inventory</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-logo">
                    <img src="{{ url_for('static', filename='Logo.jpg') }}" alt="MCVIL DENTAL CLINIC" class="sidebar-logo">
                </div>
                <h1>MCVIL DENTAL CLINIC</h1>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DISCOVER</div>
                <a href="{{ url_for('dashboard') }}" class="nav-item">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">INVENTORY</div>
                <a href="{{ url_for('inventory') }}" class="nav-item active">
                    <i class="fas fa-boxes"></i>
                    Inventory Items
                </a>
                <a href="{{ url_for('add_item') }}" class="nav-item">
                    <i class="fas fa-plus"></i>
                    Add Item
                </a>
                <a href="{{ url_for('categories') }}" class="nav-item">
                    <i class="fas fa-tags"></i>
                    Categories
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">REPORTS</div>
                <a href="{{ url_for('transactions') }}" class="nav-item">
                    <i class="fas fa-exchange-alt"></i>
                    Transactions
                </a>
                <a href="{{ url_for('reports') }}" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    Reports
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">SETTINGS</div>
                <a href="{{ url_for('logout') }}" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>Inventory Items</h1>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search by name, quantity, unit">
                        <button class="search-clear" id="clearSearch" style="display:none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success fade-in">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="content-card fade-in">
                <div class="content-card-header">
                    <div class="content-card-title">
                        <i class="fas fa-list"></i>
                        All Items
                    </div>
                </div>
                <div class="content-card-body">
                    {% if items %}
                    <table class="inventory-table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Min Level</th>
                                <th>Unit</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr class="inventory-row" data-name="{{ item[1]|lower }}" data-quantity="{{ item[2] }}" data-unit="{{ item[4]|lower }}">
                                <td><strong>{{ item[1] }}</strong></td>
                                <td>{{ item[2] }}</td>
                                <td>{{ item[3] }}</td>
                                <td>{{ item[4] }}</td>
                                <td>
                                    {% if item[2] <= item[3] %}
                                        <span class="badge badge-danger">Low Stock</span>
                                    {% else %}
                                        <span class="badge badge-success">Good</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-small btn-danger dec-btn" data-id="{{ item[0] }}" title="Hold to deduct multiple" style="margin-right:6px;">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <a href="{{ url_for('edit_item', item_id=item[0]) }}" class="btn btn-small btn-primary">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                    <a href="{{ url_for('delete_item', item_id=item[0]) }}" class="btn btn-small btn-danger" onclick="return confirm('Are you sure?')" style="margin-left:6px;">
                                        <i class="fas fa-trash"></i> Delete
                                    </a>
                                    
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                        <div style="text-align:center; padding:2rem; color:var(--text-secondary);">
                            <i class="fas fa-box-open" style="font-size:3rem; margin-bottom:1rem; opacity:.5;"></i>
                            <p>No inventory items found</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Setup search functionality
            setupSearch('searchInput', 'clearSearch', '.inventory-row', ['data-name', 'data-quantity', 'data-unit']);

            // Decrement on click/hold: each click deducts 1; holding rapidly deducts
            function sendDecrement(itemId, amount) {
                const formData = new FormData();
                formData.append('decrement', String(amount));
                fetch(`{{ url_for('decrement_item', item_id=0) }}`.replace('0', itemId), {
                    method: 'POST',
                    body: formData,
                    cache: 'no-store'
                }).then(() => {
                    // Refresh to reflect new quantities
                    location.reload();
                }).catch(() => {});
            }

            document.querySelectorAll('.dec-btn').forEach(function(btn) {
                let holdTimeout;
                let repeatInterval;
                const itemId = btn.getAttribute('data-id');
                const trigger = () => sendDecrement(itemId, 1);
                const start = (e) => {
                    e.preventDefault();
                    trigger();
                    // Begin repeating only if the button is held for 300ms
                    holdTimeout = setTimeout(function() {
                        repeatInterval = setInterval(trigger, 150);
                    }, 300);
                };
                const stop = () => {
                    clearTimeout(holdTimeout);
                    clearInterval(repeatInterval);
                };
                btn.addEventListener('mousedown', start);
                btn.addEventListener('mouseup', stop);
                btn.addEventListener('mouseleave', stop);
                btn.addEventListener('touchstart', function(e) { start(e); }, { passive: false });
                btn.addEventListener('touchend', stop);
            });
        });
    </script>
</body>
</html>

